"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var path=_interopDefault(require("path")),fs=_interopDefault(require("fs")),mkdirp=_interopDefault(require("mkdirp")),xmlbuilder=_interopDefault(require("xmlbuilder")),stripAnsi=_interopDefault(require("strip-ansi")),dateformat=_interopDefault(require("dateformat"));function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}const config={};try{const e=fs.readFileSync(path.join(process.cwd(),"package.json"),"utf8");e&&Object.assign(config,JSON.parse(e)["jest-html-reporter"])}catch(e){}try{const e=fs.readFileSync(path.join(process.cwd(),"jesthtmlreporter.config.json"),"utf8");e&&Object.assign(config,JSON.parse(e))}catch(e){}const getOutputFilepath=()=>config.outputPath||process.env.JEST_HTML_REPORTER_OUTPUT_PATH||path.join(process.cwd(),"test-report.html"),getTheme=()=>config.theme||process.env.JEST_HTML_REPORTER_THEME||"defaultTheme",getStylesheetFilepath=()=>config.styleOverridePath||process.env.JEST_HTML_REPORTER_STYLE_OVERRIDE_PATH||path.join(__dirname,`../style/${getTheme()}.css`),getPageTitle=()=>config.pageTitle||process.env.JEST_HTML_REPORTER_PAGE_TITLE||"Test report",shouldIncludeFailureMessages=()=>config.includeFailureMsg||process.env.JEST_HTML_REPORTER_INCLUDE_FAILURE_MSG||!1,getExecutionTimeWarningThreshold=()=>config.executionTimeWarningThreshold||process.env.JEST_HTML_REPORTER_EXECUTION_TIME_WARNING_THRESHOLD||5,getDateFormat=()=>config.dateFormat||process.env.JEST_HTML_REPORTER_DATE_FORMAT||"yyyy-mm-dd HH:MM:ss",getSort=()=>config.sort||process.env.JEST_HTML_REPORTER_SORT||"default";var config_1={config:config,getOutputFilepath:getOutputFilepath,getStylesheetFilepath:getStylesheetFilepath,getPageTitle:getPageTitle,shouldIncludeFailureMessages:shouldIncludeFailureMessages,getExecutionTimeWarningThreshold:getExecutionTimeWarningThreshold,getTheme:getTheme,getDateFormat:getDateFormat,getSort:getSort},sorting=createCommonjsModule(function(e){const t=e=>{const t=[],s=[],r=[];return e.forEach(e=>{const o=[],n=[],i=[];e.testResults.forEach(e=>{"pending"===e.status?o.push(e):"failed"===e.status?n.push(e):i.push(e)}),o.length&&t.push(Object.assign({},e,{testResults:o})),n.length&&s.push(Object.assign({},e,{testResults:n})),i.length&&r.push(Object.assign({},e,{testResults:i}))}),[].concat(t,s,r)};e.exports={sortSuiteResults:(e,s)=>"status"===s?t(e):e,sortSuiteResultsByStatus:t}}),sorting_1=sorting.sortSuiteResults,sorting_2=sorting.sortSuiteResultsByStatus,methods=createCommonjsModule(function(e){const t=({type:e,msg:t,ignoreConsole:s})=>{const r={default:"[37m%s[0m",success:"[32m%s[0m",error:"[31m%s[0m"},o=r[e]?r[e]:r.default,n=`jest-html-reporter >> ${t}`;return s||console.log(o,n),{logColor:o,logMsg:n}},s=e=>{return sorting.sortSuiteResults(e,config_1.getSort())},r=(e,t)=>new Promise((s,r)=>{mkdirp(path.dirname(e),o=>o?r(new Error(`Something went wrong when creating the file: ${o}`)):s(fs.writeFile(e,t)))}),o=e=>xmlbuilder.create({html:{head:{meta:{"@charset":"utf-8"},title:{"#text":config_1.getPageTitle()},style:{"@type":"text/css","#text":e}},body:{h1:{"@id":"title","#text":config_1.getPageTitle()}}}}),n=(e,t)=>new Promise((r,n)=>{if(!e)return n(new Error("Test data missing or malformed"));const i=o(t),a=i.ele("div",{id:"metadata-container"}),l=new Date(e.startTime);return a.ele("div",{id:"timestamp"},`Start: ${dateformat(l,config_1.getDateFormat())}`),a.ele("div",{id:"summary"},`\n\t\t${e.numTotalTests} tests --\n\t\t${e.numPassedTests} passed /\n\t\t${e.numFailedTests} failed /\n\t\t${e.numPendingTests} pending\n\t`),s(e.testResults).forEach(e=>{if(!e.testResults||e.testResults.length<=0)return;const t=i.ele("div",{class:"suite-info"});t.ele("div",{class:"suite-path"},e.testFilePath);const s=(e.perfStats.end-e.perfStats.start)/1e3;t.ele("div",{class:`suite-time${s>5?" warn":""}`},`${s}s`);const r=i.ele("table",{class:"suite-table",cellspacing:"0",cellpadding:"0"});e.testResults.forEach(e=>{const t=r.ele("tr",{class:e.status});t.ele("td",{class:"suite"},e.ancestorTitles.join(" > "));const s=t.ele("td",{class:"test"},e.title);if(e.failureMessages&&config_1.shouldIncludeFailureMessages()){const t=s.ele("div",{class:"failureMessages"});e.failureMessages.forEach(e=>{t.ele("p",{class:"failureMsg"},stripAnsi(e))})}t.ele("td",{class:"result"},"passed"===e.status?`${e.status} in ${e.duration/1e3}s`:e.status)})}),r(i)});e.exports={logMessage:t,processSuiteResults:s,writeFile:r,createReport:(e,s)=>{const o=config_1.getOutputFilepath();return(()=>new Promise((e,t)=>{const s=config_1.getStylesheetFilepath();fs.readFile(s,"utf8",(r,o)=>r?t(new Error(`Could not locate the stylesheet: '${s}': ${r}`)):e(o))}))().then(n.bind(null,e)).then(r.bind(null,o)).then(()=>t({type:"success",msg:`Report generated (${o})`,ignoreConsole:s})).catch(e=>t({type:"error",msg:e,ignoreConsole:s}))},createHtml:o,renderHTML:n}}),methods_1=methods.logMessage,methods_2=methods.processSuiteResults,methods_3=methods.writeFile,methods_4=methods.createReport,methods_5=methods.createHtml,methods_6=methods.renderHTML;class HtmlReporter{constructor(e,t){this._globalConfig=e,this._options=t}onRunComplete(e,t){return methods.createReport(t)}}var src=HtmlReporter;module.exports=src;
